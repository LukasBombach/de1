"use strict";var sblendidBindingsMacos=require("sblendid-bindings-macos"),events=require("events");function __awaiter(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,u)}c((r=r.apply(t,e||[])).next())})}function __generator(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}var e=function(){return(e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function i(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,u)}c((r=r.apply(t,e||[])).next())})}function r(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}var s=function(){function t(){this.items=[],this.working=!1}return t.prototype.add=function(t){return i(this,void 0,void 0,function(){var e=this;return r(this,function(n){return[2,new Promise(function(n,r){e.items.push(e.getItem(t,n,r)),e.work()})]})})},t.prototype.end=function(t){return void 0===t&&(t=function(){}),i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return this.items=[],[4,t()];case 1:return[2,e.sent()]}})})},t.prototype.work=function(){return i(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:if(this.working)return[2];this.working=!0,t.label=1;case 1:return this.items.length?[4,this.items.shift()()]:[3,3];case 2:return t.sent(),[3,1];case 3:return this.working=!1,[2]}})})},t.prototype.getItem=function(t,e,n){var r=this.getItemAsFn(t);return function(){return r().then(e).catch(n)}},t.prototype.getItemAsFn=function(t){var e=this;return"function"!=typeof t?function(){return i(e,void 0,void 0,function(){return r(this,function(e){return[2,t]})})}:function(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];return i(e,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,t.apply(void 0,n)];case 1:return[2,e.sent()]}})})}},t}(),o={read:!1,write:!1,notify:!1},u=function(){function t(t,e,n,r){this.eventEmitter=new events.EventEmitter,this.isNotifying=!1,this.service=t,this.uuid=e,this.converter=n,this.properties=r,this.adapter=t.adapter}return t.fromNoble=function(e,n,r){for(var i=Object.assign({},o),s=0,u=n.properties;s<u.length;s++)i[u[s]]=!0;return new t(e,n.uuid,r,i)},t.prototype.read=function(){return i(this,void 0,void 0,function(){var t;return r(this,function(e){switch(e.label){case 0:return[4,this.dispatchRead()];case 1:return t=e.sent(),[4,this.decode(t)];case 2:return[2,e.sent()]}})})},t.prototype.write=function(t){return i(this,void 0,void 0,function(){var e;return r(this,function(n){switch(n.label){case 0:return[4,this.encode(t)];case 1:return e=n.sent(),[4,this.dispatchWrite(e)];case 2:return n.sent(),[2]}})})},t.prototype.on=function(t,e){return i(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return this.eventEmitter.on(t,e),this.isNotifying?[3,2]:[4,this.startNotifing()];case 1:n.sent(),n.label=2;case 2:return[2]}})})},t.prototype.off=function(t,e){return i(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return this.eventEmitter.listenerCount("notify")?[3,2]:[4,this.stopNotifing()];case 1:n.sent(),n.label=2;case 2:return this.eventEmitter.off(t,e),[2]}})})},t.prototype.decode=function(t){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return this.converter&&this.converter.decode?[4,this.converter.decode(t)]:[2,t];case 1:return[2,e.sent()]}})})},t.prototype.encode=function(t){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return this.converter&&this.converter.encode?[4,this.converter.encode(t)]:[2,t];case 1:return[2,e.sent()]}})})},t.prototype.startNotifing=function(){return i(this,void 0,void 0,function(){var t;return r(this,function(e){switch(e.label){case 0:return this.isNotifying?[2]:(this.adapter.on("read",this.onNotify.bind(this)),t=this,[4,this.notify(!0)]);case 1:return t.isNotifying=e.sent(),[2]}})})},t.prototype.stopNotifing=function(){return i(this,void 0,void 0,function(){var t;return r(this,function(e){switch(e.label){case 0:return this.isNotifying?(this.adapter.off("read",this.onNotify.bind(this)),t=this,[4,this.notify(!1)]):[2];case 1:return t.isNotifying=e.sent(),[2]}})})},t.prototype.onNotify=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return i(this,void 0,void 0,function(){var e,n,i,s,o,u,c,a;return r(this,function(r){switch(r.label){case 0:return e=t[0],n=t[1],i=t[2],s=t[3],o=t[4],this.isThis(e,n,i)?(c=(u=this.eventEmitter).emit,a=["notify"],[4,this.decode(s)]):[2];case 1:return c.apply(u,a.concat([r.sent(),{isNfy:o}])),[2]}})})},t.prototype.isThis=function(t,e,n){return this.getUuids().every(function(r,i){return r===[t,e,n][i]})},t.prototype.getUuids=function(){return[this.service.peripheral.uuid,this.service.uuid,this.uuid]},t.prototype.dispatchRead=function(){return i(this,void 0,void 0,function(){var t,e,n,i,s=this;return r(this,function(r){switch(r.label){case 0:return t=this.getUuids(),e=t[0],n=t[1],i=t[2],[4,this.adapter.run(function(){return s.adapter.read(e,n,i)},function(){return s.adapter.when("read",function(t,e,n){return s.isThis(t,e,n)})},function(t){return t[3]})];case 1:return[2,r.sent()]}})})},t.prototype.dispatchWrite=function(t){return i(this,void 0,void 0,function(){var e,n,i,s,o=this;return r(this,function(r){switch(r.label){case 0:return e=this.getUuids(),n=e[0],i=e[1],s=e[2],[4,this.adapter.run(function(){return o.adapter.write(n,i,s,t,!0)},function(){return o.adapter.when("write",function(t,e,n){return o.isThis(t,e,n)})})];case 1:return r.sent(),[2]}})})},t.prototype.notify=function(t){return i(this,void 0,void 0,function(){var e,n,i,s,o=this;return r(this,function(r){switch(r.label){case 0:return e=this.getUuids(),n=e[0],i=e[1],s=e[2],[4,this.adapter.run(function(){return o.adapter.notify(n,i,s,t)},function(){return o.adapter.when("notify",function(t,e,n){return o.isThis(t,e,n)})},function(t){return t[3]})];case 1:return[2,r.sent()]}})})},t}(),c=function(){function t(t,e,n){void 0===n&&(n=[]),this.peripheral=t,this.adapter=t.adapter,this.converters=n,this.uuid=e}return t.prototype.read=function(t){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.getCharacteristic(t)];case 1:return[4,e.sent().read()];case 2:return[2,e.sent()]}})})},t.prototype.write=function(t,e){return i(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return[4,this.getCharacteristic(t)];case 1:return[4,n.sent().write(e)];case 2:return n.sent(),[2]}})})},t.prototype.on=function(t,e){return i(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return[4,this.getCharacteristic(t)];case 1:return[4,n.sent().on("notify",e)];case 2:return n.sent(),[2]}})})},t.prototype.off=function(t,e){return i(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return[4,this.getCharacteristic(t)];case 1:return[4,n.sent().off("notify",e)];case 2:return n.sent(),[2]}})})},t.prototype.getCharacteristic=function(t){return i(this,void 0,void 0,function(){var e,n,i;return r(this,function(r){switch(r.label){case 0:return[4,this.getCharacteristics()];case 1:if(e=r.sent(),n=this.getConverter(t),!(i=e[n?n.uuid:t]))throw new Error("Cannot find characteristic");return[2,i]}})})},t.prototype.getCharacteristics=function(){return i(this,void 0,void 0,function(){var t,e,n=this;return r(this,function(r){switch(r.label){case 0:return this.characteristics?[2,this.characteristics]:[4,this.fetchCharacteristics()];case 1:return t=r.sent(),e=t.map(function(t){return n.getCFromN(t)}),this.characteristics=this.uuidMap(e),[2,this.characteristics]}})})},t.prototype.getIds=function(){return[this.peripheral.uuid,this.uuid]},t.prototype.isThis=function(t,e){return t===this.peripheral.uuid&&e===this.uuid},t.prototype.getConverter=function(t){return this.converters.find(function(e){return[e.name,e.uuid].includes(t)})},t.prototype.uuidMap=function(t){return t.reduce(function(t,n){var r;return e({},t,((r={})[n.uuid]=n,r))},{})},t.prototype.getCFromN=function(t){return u.fromNoble(this,t,this.getConverter(t.uuid))},t.prototype.fetchCharacteristics=function(){return i(this,void 0,void 0,function(){var t,e,n,i,s=this;return r(this,function(r){switch(r.label){case 0:return t=this.getIds(),e=t[0],n=t[1],i=function(t,e){return s.isThis(t,e)},[4,this.adapter.run(function(){return s.adapter.discoverCharacteristics(e,n,[])},function(){return s.adapter.when("characteristicsDiscover",i)},function(t){return t[2]})];case 1:return[2,r.sent()]}})})},t}(),a=function(){function t(t,e){this.name="",this.advertisement={},this.manufacturerData=Buffer.from(""),this.state="disconnected",this.adapter=t,this.uuid=e}return t.fromDiscover=function(e,n){var r=new t(e,n[0]);return r.address=n[1],r.addressType=n[2],r.connectable=n[3],r.advertisement=n[4]||{},r.manufacturerData=r.advertisement.manufacturerData||Buffer.from(""),r.name=r.advertisement.localName||r.manufacturerData.toString("hex"),r},t.prototype.connect=function(){return i(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return this.state="connecting",[4,this.dispatchConnect()];case 1:return t.sent(),this.state="connected",[2]}})})},t.prototype.disconnect=function(){return i(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return this.state="disconnecting",[4,this.dispatchDisconnect()];case 1:return t.sent(),this.state="disconnected",[2]}})})},t.prototype.getService=function(t,e){return i(this,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return[4,this.getServices((n={},n[t]=e,n))];case 1:return[2,r.sent().find(function(e){return e.uuid===t})]}})})},t.prototype.getServices=function(t){return void 0===t&&(t={}),i(this,void 0,void 0,function(){var e,n=this;return r(this,function(r){switch(r.label){case 0:return"disconnected"!==this.state?[3,2]:[4,this.connect()];case 1:r.sent(),r.label=2;case 2:return this.serviceUuids?[3,4]:(e=this,[4,this.fetchServices()]);case 3:e.serviceUuids=r.sent(),r.label=4;case 4:return[2,this.serviceUuids.map(function(e){return new c(n,e,t[e])})]}})})},t.prototype.hasService=function(t){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.getServices()];case 1:return[2,e.sent().some(function(e){return e.uuid===t})]}})})},t.prototype.getRssi=function(){return i(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return"disconnected"!==this.state?[3,2]:[4,this.connect()];case 1:t.sent(),t.label=2;case 2:return[4,this.fetchRssi()];case 3:return[2,t.sent()]}})})},t.prototype.isConnected=function(){return"connected"===this.state},t.prototype.fetchServices=function(){return i(this,void 0,void 0,function(){var t=this;return r(this,function(e){switch(e.label){case 0:return[4,this.adapter.run(function(){return t.adapter.discoverServices(t.uuid,[])},function(){return t.adapter.when("servicesDiscover",function(e){return e===t.uuid})},function(t){return t[1]})];case 1:return[2,e.sent()]}})})},t.prototype.fetchRssi=function(){return i(this,void 0,void 0,function(){var t=this;return r(this,function(e){switch(e.label){case 0:return[4,this.adapter.run(function(){return t.adapter.updateRssi(t.uuid)},function(){return t.adapter.when("rssiUpdate",function(e){return e===t.uuid})},function(t){return t[1]})];case 1:return[2,e.sent()]}})})},t.prototype.dispatchConnect=function(){return i(this,void 0,void 0,function(){var t=this;return r(this,function(e){switch(e.label){case 0:return[4,this.adapter.run(function(){return t.adapter.connect(t.uuid)},function(){return t.adapter.when("connect",function(e){return e===t.uuid})})];case 1:return e.sent(),[2]}})})},t.prototype.dispatchDisconnect=function(){return i(this,void 0,void 0,function(){var t=this;return r(this,function(e){switch(e.label){case 0:return[4,this.adapter.run(function(){return t.adapter.disconnect(t.uuid)},function(){return t.adapter.when("disconnect",function(e){return e===t.uuid})})];case 1:return e.sent(),[2]}})})},t}(),h=function(){function t(t){this.bindings=t}return t.prototype.init=function(){this.bindings.init()},t.prototype.startScanning=function(t,e){this.bindings.startScanning(t,e)},t.prototype.stopScanning=function(){this.bindings.stopScanning()},t.prototype.connect=function(t){this.bindings.connect(t)},t.prototype.disconnect=function(t){this.bindings.disconnect(t)},t.prototype.updateRssi=function(t){this.bindings.updateRssi(t)},t.prototype.discoverServices=function(t,e){this.bindings.discoverServices(t,e)},t.prototype.discoverIncludedServices=function(t,e,n){this.bindings.discoverIncludedServices(t,e,n)},t.prototype.discoverCharacteristics=function(t,e,n){this.bindings.discoverCharacteristics(t,e,n)},t.prototype.read=function(t,e,n){this.bindings.read(t,e,n)},t.prototype.write=function(t,e,n,r,i){this.bindings.write(t,e,n,r,i)},t.prototype.broadcast=function(t,e,n,r){this.bindings.broadcast(t,e,n,r)},t.prototype.notify=function(t,e,n,r){this.bindings.notify(t,e,n,r)},t.prototype.discoverDescriptors=function(t,e,n){this.bindings.discoverDescriptors(t,e,n)},t.prototype.readValue=function(t,e,n,r){this.bindings.readValue(t,e,n,r)},t.prototype.writeValue=function(t,e,n,r,i){this.bindings.writeValue(t,e,n,r,i)},t.prototype.readHandle=function(t,e){this.bindings.readHandle(t,e)},t.prototype.writeHandle=function(t,e,n,r){this.bindings.writeHandle(t,e,n,r)},t.prototype.on=function(t,e){this.bindings.on(t,e)},t.prototype.off=function(t,e){this.bindings.off(t,e)},t.prototype.once=function(t,e){this.bindings.once(t,e)},t.prototype.run=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];return i(this,void 0,void 0,function(){var i,s,o,u,c,a;return r(this,function(r){switch(r.label){case 0:return[4,Promise.all([e(),t()])];case 1:i=r.sent()[0],s=n.slice(0,-1),o=n.slice(-1).pop(),u=0,c=s,r.label=2;case 2:return u<c.length?[4,(0,c[u])(i)]:[3,5];case 3:r.sent(),r.label=4;case 4:return u++,[3,2];case 5:return(a=o)?[4,o(i)]:[3,7];case 6:a=r.sent(),r.label=7;case 7:return[2,a||i]}})})},t.prototype.when=function(t,e){var n=this;return new Promise(function(o,u){var c=new s,a=function(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];return i(n,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return[4,c.add(function(){return e.apply(void 0,s)})];case 1:return(n=r.sent())?[4,c.end(function(){return o(s)})]:[3,3];case 2:r.sent(),r.label=3;case 3:return n&&this.off(t,a),[2]}})})};n.on(t,a)})},t.prototype.asPeripheral=function(t){var e=this;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t(a.fromDiscover(e,n))}},t}(),f=function(){function t(){this.adapter=new h(new sblendidBindingsMacos.Bindings),this.scanListener=function(){}}return t.powerOn=function(){return i(this,void 0,void 0,function(){var e;return r(this,function(n){switch(n.label){case 0:return[4,(e=new t).powerOn()];case 1:return n.sent(),[2,e]}})})},t.connect=function(e){return i(this,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return[4,t.powerOn()];case 1:return[4,r.sent().find(e)];case 2:return[4,(n=r.sent()).connect()];case 3:return r.sent(),[2,n]}})})},t.prototype.powerOn=function(){return i(this,void 0,void 0,function(){var t=this;return r(this,function(e){switch(e.label){case 0:return[4,this.adapter.run(function(){return t.adapter.init()},function(){return t.adapter.when("stateChange",function(t){return"poweredOn"===t})})];case 1:return e.sent(),[2]}})})},t.prototype.find=function(t){return i(this,void 0,void 0,function(){var e=this;return r(this,function(n){switch(n.label){case 0:return[4,this.adapter.run(function(){return e.adapter.startScanning()},function(){return e.adapter.when("discover",e.getFindCondition(t))},function(){return e.adapter.stopScanning()},function(t){return a.fromDiscover(e.adapter,t)})];case 1:return[2,n.sent()]}})})},t.prototype.startScanning=function(t){void 0===t&&(t=function(){}),this.adapter.off("discover",this.scanListener),this.scanListener=this.adapter.asPeripheral(t),this.adapter.on("discover",this.scanListener),this.adapter.startScanning()},t.prototype.stopScanning=function(){this.adapter.off("discover",this.scanListener),this.scanListener=function(){},this.adapter.stopScanning()},t.prototype.getFindCondition=function(t){return"function"==typeof t?this.adapter.asPeripheral(t):this.adapter.asPeripheral(function(e){return[e.uuid,e.address,e.name].includes(t)})},t}(),Parser=function(){function t(t){this.dataView=this.getDataView(t),this.offset=0,this.varsInternal={}}return t.prototype.char=function(t){var e=this.dataView.getUint8(this.offset);return this.setVar(t,e),this.offset+=1,this},t.prototype.short=function(t,e){void 0===e&&(e=1);var n=this.dataView.getUint16(this.offset,!1)/e;return this.setVar(t,n),this.offset+=2,this},t.prototype.int=function(t){var e=this.dataView.getUint32(this.offset,!0);return this.setVar(t,e),this.offset+=4,this},t.prototype.sha=function(t){var e=this.dataView.getUint32(this.offset,!0).toString(16),n="0"===e?"":e;return this.setVar(t,n),this.offset+=4,this},t.prototype.vars=function(){return this.varsInternal},t.prototype.getDataView=function(t){return t instanceof DataView?t:new DataView(t.buffer)},t.prototype.setVar=function(t,e){var n=t.split("."),r=n[n.length-1],i=this.varsInternal;n.slice(0,-1).forEach(function(t){void 0===i[t]&&(i[t]={}),i=i[t]}),i[r]=e},t}(),Serializer=function(){function t(){this.values=[]}return t.prototype.char=function(t){return this.add("Uint8",t),this},t.prototype.short=function(t){return this.add("Uint16",t,!1),this},t.prototype.int=function(t){return this.add("Uint16",t,!0),this},t.prototype.sha=function(t){return this.add("Uint16",parseInt(t,16),!0),this},t.prototype.dataView=function(){var t=this.getBufferLength(),e=new ArrayBuffer(t),n=new DataView(e);return this.setValues(n),n},t.prototype.buffer=function(){return Buffer.from(this.dataView().buffer)},t.prototype.setValues=function(t,e){var n=this;void 0===e&&(e=0),this.values.forEach(function(r){var i=r.type,s=r.value,o=r.littleEndian;t["set"+i](e,s,o),e+=n.typeLength(i)})},t.prototype.add=function(t,e,n){void 0!==e&&this.values.push({type:t,value:e,littleEndian:n})},t.prototype.getBufferLength=function(){var t=this;return this.values.map(function(e){var n=e.type;return t.typeLength(n)}).reduce(function(t,e){return t+e},0)},t.prototype.typeLength=function(e){return t.bufferLengths[e]},t.bufferLengths={Uint8:1,Uint16:2,Uint32:4},t}(),converter={name:"state",uuid:"a003",encode:encode,decode:decode},states={sleep:0,goingToSleep:1,idle:2,busy:3,espresso:4,steam:5,hotWater:6,shortCal:7,selfTest:8,longCal:9,descale:10,fatalError:11,init:12,noRequest:13,skipToNext:14,hotWaterRinse:15,steamRinse:16,refill:17,clean:18,inBootLoader:19,airPurge:20};function decode(t){var e=parse(t).state,n=getNameFromValue(e);if(!n)throw new Error("Received unexpected state "+e);return n}function encode(t){if(void 0===states[t])throw new Error('Unknown state "'+t+'"');return serialize(t)}function parse(t){return new Parser(t).char("state").char("substate").vars()}function serialize(t){return(new Serializer).char(states[t]).char(0).buffer()}function getNameFromValue(t){for(var e in states)if(states[e]===t)return e}var converters=[converter],DE1=function(){function t(){}return t.prototype.getAdapter=function(){if(!this.machine)throw new Error("No Machine, not connected?");return this.machine.adapter},t.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return[4,(e=new t).connect()];case 1:return n.sent(),[2,e]}})})},t.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return this.isConnected()?[2]:(t=this,[4,f.connect("DE1")]);case 1:return t.machine=n.sent(),e=this,[4,this.machine.getService("a000",converters)];case 2:return e.service=n.sent(),[2]}})})},t.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.isConnected()?[4,this.machine.disconnect()]:[2];case 1:return t.sent(),this.machine=void 0,this.service=void 0,[2]}})})},t.prototype.turnOn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.isTurnedOn()];case 1:return t.sent()?[3,3]:[4,this.set("state","idle")];case 2:t.sent(),t.label=3;case 3:return[4,this.get("state")];case 4:return[2,t.sent()]}})})},t.prototype.turnOff=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.set("state","sleep")];case 1:return t.sent(),[4,this.get("state")];case 2:return[2,t.sent()]}})})},t.prototype.isTurnedOn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.get("state")];case 1:return[2,"sleep"!==t.sent()]}})})},t.prototype.startEspresso=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.set("state","espresso")];case 1:return[2,t.sent()]}})})},t.prototype.getWaterlevel=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.get("water")];case 1:return[2,t.sent().level]}})})},t.prototype.isConnected=function(){return!!this.machine&&this.machine.isConnected()},t.prototype.get=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getService().read(t)];case 1:return[2,e.sent()]}})})},t.prototype.set=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getService().write(t,e)];case 1:return[2,n.sent()]}})})},t.prototype.on=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getService().on(t,e)];case 1:return n.sent(),[2]}})})},t.prototype.off=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getService().off(t,e)];case 1:return n.sent(),[2]}})})},t.prototype.getService=function(){if(!this.isConnected())throw new Error("Not connected to DE1");if(!this.service)throw new Error("Could not read service");return this.service},t}();module.exports=DE1;
